\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, pdfpages, pdflscape, lscape, color, listings, hyperref, amssymb, graphicx,textcomp,varioref, afterpage, subcaption, float, bm, tikz, multicol} 

\global
\newcommand{\Fig}[1]{Figure \ref{#1}}
\newcommand{\fig}[1]{figure \ref{#1}}
\newcommand{\tab}[1]{table \ref{#1}}
\newcommand{\eq}[1]{equation \ref{#1}}
\newcommand{\Eq}[1]{Equation \ref{#1}}
\newcommand{\alg}[1]{algorithm \ref{#1}}
\newcommand{\Alg}[1]{Algorithm \ref{#1}}
\newcommand{\chp}[1]{chapter  \ref{#1}}
\newcommand{\Chp}[1]{Chapter  \ref{#1}}
\newcommand{\e}[1]{\cdot 10^{#1}}
\newcommand{\h}{\hbar}
\newcommand{\der}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dder}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\newcommand{\p}{\boldsymbol{P}}
\newcommand{\q}{\boldsymbol{q}}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\coef}[2]{\frac{\langle #1,#2\rangle_Q}{\norm{#2}^}}


\newenvironment{test}[1]
{
 \usebackgroundtemplate{}
 \color{gray!30!black}
   \begin{tikzpicture}[remember picture, overlay]
     \node[anchor = center, opacity=.25] (image) at (current page.center) {\includegraphics[scale=0.25]{chaospy_logo.jpg}};
   \end{tikzpicture}
 \begin{frame}[fragile,enviroment=chaospy]
   
}
{
 \end{frame}
}

\lstset{
escapeinside=||
}


\newenvironment{chaospy}[1]
{\color{gray!30!black}
     \color{gray!30!black}
     \usebackgroundtemplate{
   \begin{tikzpicture}[remember picture, overlay]
     \node[anchor = center, opacity=.25] (image) at (current page.center) {\includegraphics[scale=0.25]{chaospy_logo.jpg}};
   \end{tikzpicture}}
     \begin{frame}[fragile,environment=chaospy]
    \frametitle{{#1}}}
{\end{frame}}


\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0}
 
\usetheme{kalkulo}

\graphicspath{{./figures/}}


\title{Polynomial chaos expansions part 3: Advanced topics}
\author{Jonathan Feinberg and Simen Tenn√∏e}


\begin{document}



\begin{frame}
  \maketitle
\end{frame}




\begin{frame}
 \frametitle{Dependent variables}
 \[  P_{\mathfrak i} = P_{i_1}^{(1)}P_{i_2}^{(2)}\cdots P_{i_D}^{(D)} \qquad \mathfrak i = (i_1,i_2,...,i_D)\]
 \pause
 \begin{align*}
  \langle P_\mathfrak{i},P_\mathfrak{j}\rangle &= E(P_\mathfrak{i},P_\mathfrak{j})\\
  \onslide<2-> {&=E(P_{i_1}^{(1)}\cdots P_{i_D}^{(D)}P_{j_1}^{(1)}\cdots P_{j_D}^{(D)})}\\ 
  \onslide<3-> {&=E(P_{i_1}^{(1)}P_{j_1}^{(1)})\cdots E(P_{i_D}^{(D)}P_{j_D}^{(D)})}\\ 
  \onslide<4-> {&=\langle P_{i_1}^{(1)}P_{j_1}^{(1)}\rangle\cdots \langle P_{i_D}^{(D)}P_{j_D}^{(D)}\rangle}\\ 
  \onslide<5-> {&=\norm{P_{i_1}^{(1)}}^2\delta_{i_1j_1}\cdots \norm{P_{i_D}^{(D)}}^2\delta_{i_Dj_D}}\\ 
  \onslide<6-> { \langle P_\mathfrak{i},P_\mathfrak{j}\rangle &=\norm{P_{\mathfrak{i}}^{(1)}}\delta_{\mathfrak{i}\mathfrak{j}}}
 \end{align*}
 \onslide<7->
\begin{alert}{But the problem is:}
\[E(uv) \neq E(u)E(v) \qquad \text{when $u$ and $v$ are dependent}\]
 \end{alert}

\end{frame}


\begin{frame}
 \frametitle{Dependence}
 \begin{figure}
 \includegraphics[width = 0.9\textwidth]{dependent.png}
 \end{figure}

 \end{frame}

 
 
\begin{chaospy}{Simple transformation code}
 
 \begin{lstlisting}[language=Python]
def u(x,a, I):
  return I*np.exp(-a*x)

C = [[2,1],[1,2]]
mu = np.array([0.5,0.5])
|\pause|
R = cp.J(cp.Normal(),cp.Normal())
L =  np.linalg.cholesky(C)
Q = R*L + mu 
|\pause|
def T(r):
    result = np.dot(L,r)
    for i in range(0,len(mu)):
        result[i] += mu[i]
    return result
\end{lstlisting}
\end{chaospy}

\begin{chaospy}{Simple transformation code}
 
 \begin{lstlisting}[language=Python]
x = np.linspace(0, 1, 100)
M = 10
|\pause|
P = cp.orth_ttr(M, R)|\pause|
nodes, weights = cp.generate_quadrature(M+1, R,
                                        rule="G")|\pause|
nodes_ = T(nodes)|\pause|
solves = [u(x, s[0], s[1]) for s in nodes_.T]|\pause|
U_analytic = cp.fit_quadrature(P, nodes_,
                               weights, solves)
\end{lstlisting}
\end{chaospy}

\begin{frame}
 \frametitle{Convergence of transformation}
 \begin{figure}
 \includegraphics[width = 0.85\textwidth]{convergence_dependence.png}
 \end{figure}
 \end{frame}


 \begin{frame}
 \frametitle{Rosenblat Transformations}
 \begin{figure}
 \includegraphics[width = 0.9\textwidth]{distributions.png}
 \end{figure}

 \end{frame}
 
 
 \begin{chaospy}{Rosenblatt transformation, code}
 
 \begin{lstlisting}[language=Python]
def u(x,a, I):
    return I*np.exp(-a*x)
|\pause|
C = [[2,1],[1,2]]
mu = np.array([0.5,0.5])
dist_R = cp.J(cp.Normal(),cp.Normal())
dist_Q = cp.MvNormal(mu,C)
|\pause|
x = np.linspace(0, 1, 100)
dt = x[1]-x[0]
M = 5
\end{lstlisting}
\end{chaospy}

 \begin{chaospy}{Rosenblatt transformation, code}
 
 \begin{lstlisting}[language=Python]
P = cp.orth_ttr(M, dist_R)|\pause|
s_R = dist_R.sample(2*len(P), "M")|\pause|
s_Q = dist_Q.inv(dist_R.fwd(s_R))|\pause|

solves = [u(x, s[0], s[1]) for s in s_Q.T]|\pause|
U_hat = cp.fit_regression(P, s_R, solves,rule="LS")
\end{lstlisting}
\end{chaospy}

 \begin{frame}
 \frametitle{Convergence of Rosenblatt transformations}
 \begin{figure}
 \includegraphics[width = 0.9\textwidth]{rosenblatt.png}
 \end{figure}

 \end{frame}
  

\end{document}
